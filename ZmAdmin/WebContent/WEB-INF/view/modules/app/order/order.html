<!-- 
 * Generated by Blade.
 * 2018-01-07 12:18:34
 -->
@layout("/common/_container.html"){

<script type="text/javascript">
	var grid_selector = "#grid-table";
	var pager_selector = "#grid-pager";
	
	$(function(){
		initGrid();
		initMenuBtn("btns", "${code}");
	});
	
	function initGrid(){
		var grid_url = "${ctxPath}/${code}/list";
		var _colnames = ["主键",
                        "订单编号",
                        "充值油卡",
						"充值数量", 
						"订单金额",
						"客户名称",
						"顾客卡号", 
						"顾客姓名", 
						"顾客手机",
						"核销时间",
                        "订单状态",
                        "订单创建时间",
                        "付款方式",
                        "核销人员",
                        "核销站点"];
		var _colmodel = [{name:"id", index:"id", width:100,hidden:true},
                        {name:"order_no", index:"order_no", width:120},
						{name:"card_name", index:"card_id", width:100},
						{name:"charge_number", index:"charge_number", width:65,align:"right"},
						{name:"order_price", index:"order_price", width:65,align:"right"},
						{name:"custname",index:"custname",width:100},
						{name:"customer_card_no", index:"customer_card_no", width:150},
						{name:"customer_name", index:"customer_name", width:65},
						{name:"customer_phone", index:"customer_phone", width:100},
						{name:"charge_time", index:"charge_time", width:100},
                        {name:"status_name", index:"status", align:"center", width:100, formatter:statusShow},
						{name:"create_time", index:"create_time", width:100},
                        {name:"pay_typeName", index:"pay_type", width:100},
                        {name:"charger_name", index:"charger", width:100},
                        {name:"charger_station", index:"charger", width:100}]; 
		
		jQuery(grid_selector).jqGrid({
			url : grid_url,
		    shrinkToFit : true,
			colNames : _colnames,
			colModel : _colmodel, 
			jsonReader : {id :"id"},
			pager : pager_selector,
			postData : {sort : "create_time ", order : "desc"},
			 loadComplete: function (res) {
				 var table = this;
	                $jqGrid = $(grid_selector);
	                setTimeout(function () {
	                    updatePagerIcons(table);
	                    //自适应表格高度 -- 表格初始化后调用
	                    autoResize(grid_selector, 240);
	                }, 0);

	                //grid加载完毕，从数组中选中对应的记录
	                if (item_selected.length > 0) {
	                    for (var i = 0; i < item_selected.length; i++) {
	                        jQuery(grid_selector).jqGrid('setSelection', item_selected[i]);
	                    }
	                }

	                var records = res.records;
	                var tra = 0;
	                if (res.ext.tra != undefined) {
	                    tra = res.ext.tra.toFixed(3);
	                }

	                var html = "<div dir=\"ltr\" style=\"text-align:left\" class=\"ui-paging-info\">共 "+records+" 条, 加油量总计 <span style='color: red;'></span>, 加油金额总计 <span style='color: red;'>"+tra+" </span>元 </div>";

	                $("#grid-pager_left").html(html);

	            }
		});
	}
	
    function statusShow(cellvalue, options, rowObject) {
        var lx = rowObject.status;
        var sclass = "";
        switch (lx) {
            case 2:
                sclass = "label label-danger arrowed arrowed-right";
                break;
            case 3:
                sclass = "label label-info arrowed-right arrowed-in";
                break;
            default:
                sclass = "label label-info arrowed arrowed-right";
                break;
        }
        var html = "<span class='" + sclass + "'>" + rowObject.status_name + "</span>";
        return html;
    }
 </script>


	<!-- 配置 grid -->
	<div class="row">
		<div class="col-xs-12 tb-grid">
			<!-- 配置 查询 -->
			@ var _col=[
            @		{name:"创建订单时间", index:"create_time_gt", type:"date"},
            @		{name:"至", index:"create_time_lt", type:"date"},
            @		{name:"订单编号", index:"order_no", type:"text"},
            @		{name:"客户名称", index:"custname",type:"text"},
            @		{name:"顾客卡号", index:"customer_card_no", type:"text"},
            @		{name:"核销时间", index:"charge_time_gt", type:"date"},
            @		{name:"至", index:"charge_time_lt", type:"date"},
			@		{name:"顾客姓名", index:"customer_name", type:"text"},
			@		{name:"顾客手机", index:"customer_phone", type:"text"},
		    @		{name:"付款方式", index:"pay_type",type:"select_910"},
            @		{name:"订单状态", index:"status", type:"select_909"}
			@];
			@ include("/common/_function/_search_multi.html",{"col":_col}){}
			<!-- 按钮 -->
			<div class="welljq well-sm" id="btns"></div>
			<!-- grid -->
			<table id="grid-table"></table>
			<!-- 分页-->
			<div id="grid-pager"></div>
			<!-- 搜索后显示金额 -->
		</div>
	</div>
	
	<!-- 引入所需的js -->
	@include("/common/_listscript.html", {isExport : true}) {}
	
@}	