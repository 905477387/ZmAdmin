<!-- 
 * Generated by Blade.
 * 2017-09-09 15:42:39
 -->
@layout("/common/_container.html"){

<style>
    td{
        vertical-align: middle !important;
    }
</style>
<div class="page-header-form">
    <h2>
        充值信息
        <small>
            <i class="ace-icon fa fa-angle-double-right">
                金额
            </i>
        </small>
    </h2>
</div>
<table class="table table-bordered table-striped">
    <thead>
    <tr>
        <th>企业名称</th>
        <th>车牌号</th>
        <th>驾驶员</th>
        <th>会员卡号</th>
        <th>卡内余额</th>
        <th>充值</th>
        <th>状态</th>
    </tr>
    </thead>
    <tbody>
    @ for (x in list) {
    <tr>
        <td>${x.CustName!}</td>
        <td>${x.CarNo!}</td>
        <td>${x.HolderName!}</td>
        <td>${x.CardNo!}</td>
        <td style="text-align: right;">${x.Balance!}</td>
        <td>${x.ChargeBalance!}</td>
        <td style="text-align: center;">
            <blade:status status="${x.Status!}" name="${x.StatusName!}" />
        </td>
    </tr>
    @ }
    </tbody>
    <tfoot>
    <tr>
        <th>合计</th>
        <td colspan="6" style="text-align: center;">
                <span style="color: red; font-weight: bold;">
                    充值总金额 ：<span id="sp_total">${charge.Total!}</span>元
                </span>
        </td>
    </tr>
    </tfoot>
</table>
<div class="page-header-form">
    <h2>
        充值信息
        <small>
            <i class="ace-icon fa fa-angle-double-right">
                凭证
            </i>
        </small>
    </h2>
</div>
<table class="table table-bordered table-striped">
    @ if (charge.Status >= 3) {
    <tr>
        <td style="text-align:right;">中民能源开户行</td>
        <td><input class="form-control" id="BankName" disabled value="${charge.BankName!}" placeholder="请选择开户行" /></td>
        <td style="text-align:right;">中民能源油款充值账户</td>
        <td><input class="form-control" id="BankNo" disabled value="${charge.BankNo!}" placeholder="请先选择开户行"/></td>
    </tr>
    <tr>
        <td style="text-align:right;">流水号</td>
        <td colspan="3"><input class="form-control" disabled id="OrderNo" value="${charge.OrderNo!}" placeholder="请输入流水号"/></td>
    </tr>
    @ } else {
    <tr>
        <td style="text-align:right;">中民能源开户行</td>
        <td>
            <input class="form-control" id="BankName" value="${charge.BankNo!}" placeholder="请选择开户行" />
        </td>
        <td style="text-align:right;">中民能源油款充值账户</td>
        <td>
            <input class="form-control" disabled id="BankNo_ipt" value="${charge.BankNo!}" placeholder="请先选择开户行"/>
            <input class="form-control" type="hidden" id="BankNo" value="${charge.BankNo!}" placeholder="请先选择开户行"/>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">流水号</td>
        <td colspan="3"><input class="form-control" id="OrderNo" value="${charge.OrderNo!}" placeholder="请输入流水号"/></td>
    </tr>
    @ }
</table>
@ if (charge.Status >= 3) {
@ include("/common/_curd/_btn_diy2.html",{btn_close:"关闭"}) {}
@ } else {
@ include("/common/_curd/_btn_diy2.html",{btn_save:"重新提交", btn_cancel:"取消订单",btn_close:"关闭"}) {}
@ }

<script src="${ctxPath}/static/blade/js/blade-toolbox.js" type="text/javascript"></script>
<script src="${ctxPath}/static/blade/js/blade-combotree.js" type="text/javascript"></script>
<script>


    @ if (charge.Status < 3) {
    $(function () {
        var combotree = new BladeComboTree();
        combotree.setId("BankName");
        combotree.setSource("bank.combo");
        combotree.setCheck("radio");
        combotree.setHeight("150px");
        combotree.init();
    })
    @ }

    function comboTreeCallBackTail(id, val) {
        $("#BankNo_ipt").val(val);
        $("#BankNo").val(val);
    }

    $("#btn_save").bind("click",function(){

        if (BladeTool.isEmpty($("#BankName_ipt").val().trim())) {
            layer_alert("请选择开户行", "warn");
            return false;
        }
        if (BladeTool.isEmpty($("#OrderNo").val())) {
            layer_alert("请输入流水号", "warn");
            return false;
        }
        var ajax = new Ajax("${ctxPath}/mycharge/update", function (data) {
            if (data.code === 0) {
                layer.msg(data.message, {shift: 1});
                setTimeout(function(){
                    window.top.reloadTabById("mycharge");
                    window.top.autoClose("top_mycharge_view","mycharge");
                },500);
            } else {
                layer_alert(data.message, "error")
            }
        });
        ajax.set("id", "${charge.id!}");
        ajax.set("BankName", $("#BankName_ipt").val());
        ajax.set("BankNo", $("#BankNo").val());
        ajax.set("OrderNo", $("#OrderNo").val());
        ajax.set("Status", 1);
        ajax.start();
    });

    $("#btn_cancel").bind("click",function(){

        layer.confirm('是否取消当前订单？', {
            icon: 3,
            btn: ['确定', '取消'] //按钮
        }, function () {
            var index = appLoading();
            var ajax = new Ajax("${ctxPath}/charge/cancel", function (data) {
                if (data.code === 0) {
                    layer.msg(data.message, {shift: 1});
                    setTimeout(function(){
                        window.top.reloadTabById("mycharge");
                        window.top.autoClose("top_mycharge_view","mycharge");
                    },500);
                } else {
                    layer_alert(data.message, "error")
                }
                clearLoading(index);
            });
            ajax.set("id", "${charge.id!}");
            ajax.set("OrderNo", "${charge.OrderNo!}");
            ajax.start();

        }, function () {
            //layer.msg('已取消');
        });

    });


    $("#btn_close").bind("click",function(){
        window.top.reloadTabById("mycharge");
        window.top.autoClose("top_mycharge_view","mycharge");
    });

</script>

@}