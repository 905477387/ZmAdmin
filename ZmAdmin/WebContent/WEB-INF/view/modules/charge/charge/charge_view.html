<!-- 
 * Generated by Blade.
 * 2017-09-09 15:42:39
 -->
@layout("/common/_container.html"){

<style>
    td{
        vertical-align: middle !important;
    }
</style>
<div class="page-header-form">
    <h2>
        充值信息
        <small>
            <i class="ace-icon fa fa-angle-double-right">
                金额
            </i>
        </small>
    </h2>
</div>
<table class="table table-bordered table-striped">
    <thead>
    <tr>
        <th>企业名称</th>
        <th>车牌号</th>
        <th>驾驶员</th>
        <th>会员卡号</th>
        <th>卡内余额</th>
        <th>充值</th>
        <th>状态</th>
        @ if (charge.Status == 3) {
            <th>操作</th>
        @ }
    </tr>
    </thead>
    <tbody>
    @ for (x in list) {
    <tr>
        <td>${x.CustName!}</td>
        <td>${x.CarNo!}</td>
        <td>${x.HolderName!}</td>
        <td>${x.CardNo!}</td>
        <td style="text-align: right;">${x.Balance!}</td>
        <td style="text-align: right;">${x.ChargeBalance}</td>

        @ if (charge.Status == 3) {
            <td id="td_${x.CardNo!}" style="text-align: center;">
                <blade:status status="${x.Status!}" name="${x.StatusName!}" />
            </td>
            @ if (x.Status == 3) {
            <td id="td_btn_${x.CardNo!}" style="text-align: center;">
                <button id="btn_${x.CardNo!}" data-card-no="${x.CardNo!}" name="btn_charge" class="btn btn-xs btn-white ">
                    <li class=" fa fa-cny bigger-120"></li>
                    圈存
                </button>
            </td>
            @ } else {
            <td style="text-align: center;">
                <button class="btn btn-xs btn-white ">
                    暂无
                </button>
            </td>
            @ }
        @ } else {
            <td style="text-align: center;">
                <blade:status status="${x.Status!}" name="${x.StatusName!}" />
            </td>
        @ }

    </tr>
    @ }
    </tbody>
    <tfoot>
    <tr>
        <th>合计</th>
        <td colspan="7" style="text-align: center;">
                <span style="color: red; font-weight: bold;">
                    充值总金额 ：<span id="sp_total">${charge.Total!}</span>元
                </span>
        </td>
    </tr>
    </tfoot>
</table>
<div class="page-header-form">
    <h2>
        充值信息
        <small>
            <i class="ace-icon fa fa-angle-double-right">
                凭证
            </i>
        </small>
    </h2>
</div>
<table class="table table-bordered table-striped">
    <tr>
        <td style="text-align:right;">中民能源开户行</td>
        <td><input class="form-control" id="BankName" disabled value="${charge.BankName!}" placeholder="请选择开户行" /></td>
        <td style="text-align:right;">中民能源油款充值账户</td>
        <td><input class="form-control" id="BankNo" disabled value="${charge.BankNo!}" placeholder="请先选择开户行"/></td>
    </tr>
    <tr>
        <td style="text-align:right;">流水号</td>
        <td colspan="3"><input class="form-control" disabled id="OrderNo" value="${charge.OrderNo!}" placeholder="请输入流水号"/></td>
    </tr>
</table>

@ if (charge.Status >= 3) {
@ include("/common/_curd/_btn_diy2.html",{btn_close:"关闭"}) {}
@ } else {
@ include("/common/_curd/_btn_diy2.html",{btn_save:"审核通过",btn_close:"审核拒绝"}) {}
@ }

<script>

    $("button[name='btn_charge']").click(function () {
        var CardNo = $(this).attr("data-card-no");
        layer.confirm('是否标记为已圈存？', {
            icon: 3,
            btn: ['确定', '取消'] //按钮
        }, function () {
            var index = appLoading();
            var ajax = new Ajax("${ctxPath}/charge/chargeSuccess", function (data) {
                if (data.code === 0) {
                    layer.msg(data.message, {shift: 1});
                    $("#td_" + CardNo).html("<span class=\"label label-info arrowed arrowed-right\">已充值已圈存</span>");
                    $("#td_btn_" + CardNo).html("<button class=\"btn btn-xs btn-white \">暂无</button>");
                } else {
                    layer_alert(data.message, "error")
                }
                clearLoading(index);
            });
            ajax.set("CardNo", CardNo);
            ajax.set("OrderNo", "${charge.OrderNo!}");
            ajax.start();

        }, function () {
            //layer.msg('已取消');
        });
    })


    $("#btn_save").bind("click",function(){
        layer.confirm('是否审核通过？', {
            icon: 3,
            btn: ['确定', '取消'] //按钮
        }, function () {
            var index = appLoading();
            var ajax = new Ajax("${ctxPath}/charge/audit", function (data) {
                if (data.code === 0) {
                    layer.msg(data.message, {shift: 1});
                    setTimeout(function(){
                        window.top.reloadTabById("charge");
                        window.top.autoClose("top_charge_view","charge");
                    },500);
                } else {
                    layer_alert(data.message, "error")
                }
                clearLoading(index);
            });
            ajax.set("id", "${charge.id!}");
            ajax.set("OrderNo", "${charge.OrderNo!}");
            ajax.set("Status", 3);
            ajax.start();

        }, function () {
            //layer.msg('已取消');
        });
    });


    @ if (charge.Status >= 3) {
        $("#btn_close").bind("click",function(){
            window.top.reloadTabById("charge");
            window.top.autoClose("top_charge_view","charge");
        });
    @ } else {
        $("#btn_close").bind("click",function(){
            layer.confirm('是否审核拒绝？', {
                icon: 3,
                btn: ['确定', '取消'] //按钮
            }, function () {
                var ajax = new Ajax("${ctxPath}/charge/audit", function (data) {
                    if (data.code === 0) {
                        layer.msg(data.message, {shift: 1});
                        setTimeout(function(){
                            window.top.reloadTabById("charge");
                            window.top.autoClose("top_charge_view","charge");
                        },500);
                    } else {
                        layer_alert(data.message, "error")
                    }
                });
                ajax.set("id", "${charge.id!}");
                ajax.set("OrderNo", "${charge.OrderNo!}");
                ajax.set("Status", 2);
                ajax.start();

            }, function () {
                //layer.msg('已取消');
            });
        });
    @ }



</script>

@}