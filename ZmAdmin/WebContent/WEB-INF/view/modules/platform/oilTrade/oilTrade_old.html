<!-- 
 * Generated by Blade.
 * 2017-09-22 11:11:39
 -->
@layout("/common/_container.html"){

<script type="text/javascript">
    var grid_selector = "#grid-table";
    var pager_selector = "#grid-pager";

    $(function () {
        initGrid();
        initMenuBtn("btns", "${code}");
    });

    function initGrid() {
        var grid_url = "${ctxPath}/${code}/list?CardNo=${cardNo!x}";
        var _colnames = [
            "流水号",
            "站点编号",
            "站点简称",
            "客户编号",
            "客户名称",
            "单价",
            "加油量",
            "卡余额",
            "加油金额",
            "客户证件号",
            "客户证件类型",
            "卡号",
            "卡类型",
            "持卡人姓名",
            "枪号",
            "油品简称",
            "油品代码",
            "加油时间",
            "结算价",
            "结算时间",
            "支付方式",
            "积分",
            "积分余额",
            "会员卡号",
            "营业日期",
            "结算金额",
            "结算单位",
            "结算单位名称",
            "交易类型名称",
            "油站上传时间",
            "加油员名称",
            "加油员编号",
            "第三方系统客户编号",
            "班次",
            "id"];
        var _colmodel = [
            {name: "FlowNo", index: "FlowNo", width: 100},
            {name: "StationNo", index: "StationNo", width: 100},
            {name: "StationAbbreviate", index: "StationAbbreviate", width: 100},
            {name: "CustNo", index: "CustNo", width: 100},
            {name: "CustName", index: "CustName", width: 200},
            {name: "Price", index: "Price", width: 100},
            {name: "Qty", index: "Qty", width: 100},
            {name: "Balance", index: "Balance", width: 100},
            {name: "TradeMoney", index: "TradeMoney", width: 100},
            {name: "CustHolderID", index: "CustHolderID", width: 150},
            {name: "CustHolderIDTypeName", index: "CustHolderIDTypeName", width: 100},
            {name: "CardNo", index: "CardNo", width: 150},
            {name: "CardTypeName", index: "CardTypeName", width: 100},
            {name: "HolderName", index: "HolderName", width: 150},
            {name: "GunNo", index: "GunNo", width: 100},
            {name: "OilAbbreviate", index: "OilAbbreviate", width: 100},
            {name: "OilNo", index: "OilNo", width: 100},
            {name: "OilTime", index: "OilTime", width: 130},
            {name: "PayPrice", index: "PayPrice", width: 100},
            {name: "PayTime", index: "PayTime", width: 130},
            {name: "PayWayName", index: "PayWayName", width: 100},
            {name: "Points", index: "Points", width: 100},
            {name: "PointsBalance", index: "PointsBalance", width: 100},
            {name: "PointsCardNo", index: "PointsCardNo", width: 100},
            {name: "SaleDate", index: "SaleDate", width: 100},
            {name: "Settlement", index: "Settlement", width: 100},
            {name: "SettlementType", index: "SettlementType", width: 100},
            {name: "SettlementUniteName", index: "SettlementUniteName", width: 100},
            {name: "TradeTypeName", index: "TradeTypeName", width: 100},
            {name: "UploadTime", index: "UploadTime", width: 130},
            {name: "OperatorName", index: "OperatorName", width: 100},
            {name: "OperatorNo", index: "OperatorNo", width: 100},
            {name: "ThirdpartyCustNo", index: "ThirdpartyCustNo", width: 100},
            {name: "ShiftNo", index: "ShiftNo", width: 100},
            {name: "id", index: "id", width: 100, hidden: true}];

        jQuery(grid_selector).jqGrid({
            url: grid_url,
            shrinkToFit: false,
            colNames: _colnames,
            colModel: _colmodel,
            jsonReader: {id: "id"},
            pager: pager_selector,
            postData: {sort: "id", order: "desc"},
            footerrow:true,
            loadComplete: function () {
                var table = this;
                $jqGrid = $(grid_selector);
                setTimeout(function () {
                    updatePagerIcons(table);
                    //自适应表格高度 -- 表格初始化后调用
                    autoResize(grid_selector, 240);
                }, 0);

                //grid加载完毕，从数组中选中对应的记录
                if (item_selected.length > 0) {
                    for (var i = 0; i < item_selected.length; i++) {
                        jQuery(grid_selector).jqGrid('setSelection', item_selected[i]);
                    }
                }

                var oilSum = jQuery(grid_selector).getCol('Qty', false, 'sum').toFixed(2);
                var moneySum = jQuery(grid_selector).getCol('TradeMoney', false, 'sum').toFixed(2);

                jQuery(grid_selector).footerData("set",
                    {
                        "Price": "<span style='color:red'>加油量总计<span>",
                        "Qty": "<span style='color:red'>" + oilSum + "<span>",
                        "Balance": "<span style='color:red'>加油金额总计<span>",
                        "TradeMoney": "<span style='color:red'>" + moneySum + "<span>"
                    });
                //$(".ui-jqgrid-sdiv").css("margin-top", "20px");
            }
        });
    }
</script>


<!-- 配置 grid -->
<div class="row">
    <div class="col-xs-12 tb-grid">
        <!-- 配置 查询 -->
        @ var _col=[
        @ {name:"加油时间", index:"OilTime", type:"laydate",format:"YYYY-MM-DD"},
        @ {name:"加油站点", index:"StationNo", type:"selectDiy", source:"station.diy"},
        @ {name:"卡号", index:"CardNo", type:"text"},
        @ {name:"油品代码", index:"OilNo", type:"text"},
        @ {name:"油品简称", index:"OilAbbreviate", type:"text"}
        @];
        @ include("/common/_function/_search_multi.html",{"col":_col}){}
        <!-- 按钮 -->
        <div class="welljq well-sm" id="btns"></div>
        <!-- grid -->
        <table id="grid-table"></table>
        <!-- 分页-->
        <div id="grid-pager"></div>
    </div>
</div>

<!-- 引入所需的js -->
@include("/common/_listscript.html", {isExport : false}) {}

@}	