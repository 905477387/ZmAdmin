<!-- 
 * Generated by Blade.
 * 2017-09-22 11:11:39
 -->
@layout("/common/_container.html"){

<script type="text/javascript">
    var grid_selector = "#grid-table";
    var pager_selector = "#grid-pager";
    var _filter = "";//如果点了搜索按钮想让过滤条件失效,则将定义放入initGrid()中

    @ if (cardNo != "x") {
        _filter = "{'CardNo_equal':'${cardNo}'}"
    @ }

    $(function () {
        initGrid();
        initMenuBtn("btns", "${code}");
    });

    function initGrid() {
        var grid_url = "${ctxPath}/${code}/list";

        /*
        var _colnames = [
                "卡号",
                "客户名称",
                "印刷号",
                "车号",
                "卡余额",
                "卡备用金额",
                "客户代码",
                "持卡人姓名",
                "证件类型",
                "证件号",
                "流水号",
                "站点编号",
                "站点简称",
                "客户编号",
                "单价",
                "加油量",
                "卡余额",
                "加油金额",
                "卡类型",
                "枪号",
                "油品简称",
                "油品代码",
                "加油时间",
                "结算价",
                "结算时间",
                "支付方式",
                "积分",
                "积分余额",
                "会员卡号",
                "营业日期",
                "结算金额",
                "结算单位",
                "结算单位名称",
                "交易类型名称",
                "油站上传时间",
                "加油员名称",
                "加油员编号",
                "第三方系统客户编号",
                "班次",
                "id"];
            var _colmodel = [
                {name:"CardNo", index:"CardNo", width:200},
                {name:"CustName", index:"CustName", width:200},
                {name:"CardSerialNo", index:"CardSerialNo", width:100},
                {name:"CarNo", index:"CarNo", width:100},
                {name:"Balance1", index:"Balance1", width:100},
                {name:"ReserveFund", index:"ReserveFund", width:100},
                {name:"CustNo", index:"CustNo", width:150},
                {name:"HolderName", index:"HolderName", width:100},
                {name:"CustHolderIDTypeName", index:"HolderIDTypeName", width:100},
                {name:"CustHolderID", index:"HolderID", width:200},
                {name: "FlowNo", index: "FlowNo", width: 100},
                {name: "StationNo", index: "StationNo", width: 100},
                {name: "StationAbbreviate", index: "StationAbbreviate", width: 100},
                {name: "CustNo", index: "CustNo", width: 100},
                {name: "Price", index: "Price", width: 100},
                {name: "Qty", index: "Qty", width: 100},
                {name: "Balance", index: "Balance", width: 100},
                {name: "TradeMoney", index: "TradeMoney", width: 100},
                {name: "CardTypeName", index: "CardTypeName", width: 100},
                {name: "GunNo", index: "GunNo", width: 100},
                {name: "OilAbbreviate", index: "OilAbbreviate", width: 100},
                {name: "OilNo", index: "OilNo", width: 100},
                {name: "OilTime", index: "OilTime", width: 130},
                {name: "PayPrice", index: "PayPrice", width: 100},
                {name: "PayTime", index: "PayTime", width: 130},
                {name: "PayWayName", index: "PayWayName", width: 100},
                {name: "Points", index: "Points", width: 100},
                {name: "PointsBalance", index: "PointsBalance", width: 100},
                {name: "PointsCardNo", index: "PointsCardNo", width: 100},
                {name: "SaleDate", index: "SaleDate", width: 100},
                {name: "Settlement", index: "Settlement", width: 100},
                {name: "SettlementType", index: "SettlementType", width: 100},
                {name: "SettlementUniteName", index: "SettlementUniteName", width: 100},
                {name: "TradeTypeName", index: "TradeTypeName", width: 100},
                {name: "UploadTime", index: "UploadTime", width: 130},
                {name: "OperatorName", index: "OperatorName", width: 100},
                {name: "OperatorNo", index: "OperatorNo", width: 100},
                {name: "ThirdpartyCustNo", index: "ThirdpartyCustNo", width: 100},
                {name: "ShiftNo", index: "ShiftNo", width: 100},
                {name: "id", index: "id", width: 100, hidden: true}];
        * */

        var _colnames = [
            "加油时间",
            "站点简称",
            "客户名称",
            "持卡人姓名",
            "卡号",
            "印刷号",
            "车号",
            "油品简称",
            "加油量",
            "单价",
            "加油金额",
            "卡余额",
            //"卡备用金额",
            "客户代码",
            "证件类型",
            "证件号",
            "流水号",
            "站点编号",
            "客户编号",
            "卡余额",
            "卡类型",
            "枪号",
            "油品代码",
            "结算价",
            "结算时间",
            "支付方式",
            "积分",
            "积分余额",
            "会员卡号",
            "营业日期",
            "结算金额",
            "结算单位",
            "结算单位名称",
            "交易类型名称",
            "油站上传时间",
            "加油员名称",
            "加油员编号",
            "第三方系统客户编号",
            "班次",
            "id"];
        var _colmodel = [
            {name: "OilTime", index: "OilTime", width: 130},
            {name: "StationAbbreviate", index: "StationAbbreviate", width: 100},
            {name:"CustName", index:"CustName", width:200},
            {name:"HolderName", index:"HolderName", width:100},
            {name:"CardNo", index:"CardNo", width:200},
            {name:"CardSerialNo", index:"CardSerialNo", width:100},
            {name:"CarNo", index:"CarNo", width:100},
            {name: "OilAbbreviate", index: "OilAbbreviate", width: 100},
            {name: "Qty", index: "Qty", width: 100},
            {name: "Price", index: "Price", width: 100},
            {name: "TradeMoney", index: "TradeMoney", width: 100},
            {name:"Balance1", index:"Balance1", width:100},
            //{name:"ReserveFund", index:"ReserveFund", width:100},
            {name:"CustNo", index:"CustNo", width:150},
            {name:"CustHolderIDTypeName", index:"HolderIDTypeName", width:100},
            {name:"CustHolderID", index:"CustHolderID", width:200},
            {name: "FlowNo", index: "FlowNo", width: 100},
            {name: "StationNo", index: "StationNo", width: 100},
            {name: "CustNo", index: "CustNo", width: 100},
            {name: "Balance", index: "Balance", width: 100},
            {name: "CardTypeName", index: "CardTypeName", width: 100},
            {name: "GunNo", index: "GunNo", width: 100},
            {name: "OilNo", index: "OilNo", width: 100},
            {name: "PayPrice", index: "PayPrice", width: 100},
            {name: "PayTime", index: "PayTime", width: 130},
            {name: "PayWayName", index: "PayWayName", width: 100},
            {name: "Points", index: "Points", width: 100},
            {name: "PointsBalance", index: "PointsBalance", width: 100},
            {name: "PointsCardNo", index: "PointsCardNo", width: 100},
            {name: "SaleDate", index: "SaleDate", width: 100},
            {name: "Settlement", index: "Settlement", width: 100},
            {name: "SettlementType", index: "SettlementType", width: 100},
            {name: "SettlementUniteName", index: "SettlementUniteName", width: 100},
            {name: "TradeTypeName", index: "TradeTypeName", width: 100},
            {name: "UploadTime", index: "UploadTime", width: 130},
            {name: "OperatorName", index: "OperatorName", width: 100},
            {name: "OperatorNo", index: "OperatorNo", width: 100},
            {name: "ThirdpartyCustNo", index: "ThirdpartyCustNo", width: 100},
            {name: "ShiftNo", index: "ShiftNo", width: 100},
            {name: "id", index: "id", width: 100, hidden: true}];

        jQuery(grid_selector).jqGrid({
            url: grid_url,
            shrinkToFit: false,
            colNames: _colnames,
            colModel: _colmodel,
            jsonReader: {id: "id"},
            pager: pager_selector,
            postData: {where: _filter, sort: "id", order: "desc"},
            loadComplete: function (res) {
                var table = this;
                $jqGrid = $(grid_selector);
                setTimeout(function () {
                    updatePagerIcons(table);
                    //自适应表格高度 -- 表格初始化后调用
                    autoResize(grid_selector, 240);
                }, 0);

                //grid加载完毕，从数组中选中对应的记录
                if (item_selected.length > 0) {
                    for (var i = 0; i < item_selected.length; i++) {
                        jQuery(grid_selector).jqGrid('setSelection', item_selected[i]);
                    }
                }

                var records = res.records;
                var qty = 0;
                var tra = 0;
                if (res.ext.qty != undefined) {
                    qty = res.ext.qty.toFixed(3);
                }
                if (res.ext.tra != undefined) {
                    tra = res.ext.tra.toFixed(3);
                }

                var html = "<div dir=\"ltr\" style=\"text-align:left\" class=\"ui-paging-info\">共 "+records+" 条, 加油量总计 <span style='color: red;'>"+qty+"</span>, 加油金额总计 <span style='color: red;'>"+tra+" </span>元 </div>";

                $("#grid-pager_left").html(html);

            }
        });
    }
</script>


<!-- 配置 grid -->
<div class="row">
    <div class="col-xs-12 tb-grid">
        <!-- 配置 查询 -->

        @ if (cardNo != "x") {
        @ var _col=[
            @ {name:"加油开始时间", index:"OilTime_start_skip_true", type:"laydate"},
            @ {name:"加油截止时间", index:"OilTime_end_skip_true", type:"laydate"},
            @ {name:"卡号", index:"CardNo", type:"text"},
            @ {name:"车号", index:"CarNo_skip_true", type:"text"},
            @ {name:"加油站点", index:"StationNo", type:"selectDiy", source:"station.diy"},
            @ {name:"油品代码", index:"OilNo", type:"text"},
            @ {name:"油品简称", index:"OilAbbreviate", type:"selectDiy", source:"oilTrade.oilSelect"}
            @];
            @ include("/common/_function/_search_multi.html",{"col":_col}){}
        @ } else {

            @ if (shiro.hasRole("station")) {
                @ var _col=[
                @ {name:"加油开始时间", index:"OilTime_start_skip_true", type:"laydate"},
                @ {name:"加油截止时间", index:"OilTime_end_skip_true", type:"laydate"},
                @ {name:"卡号", index:"CardNo", type:"text"},
                @ {name:"车号", index:"CarNo_skip_true", type:"text"},
                @ {name:"客户代码", index:"CustNo", type:"text"},
                @ {name:"客户名称", index:"CustName", type:"text"},
                @ {name:"油品代码", index:"OilNo", type:"text"},
                @ {name:"油品简称", index:"OilAbbreviate", type:"selectDiy", source:"oilTrade.oilSelect"}
                @];
                @ include("/common/_function/_search_multi.html",{"col":_col}){}
            @ } else {
                @ var _col=[
                @ {name:"加油开始时间", index:"OilTime_start_skip_true", type:"laydate"},
                @ {name:"加油截止时间", index:"OilTime_end_skip_true", type:"laydate"},
                @ {name:"卡号", index:"CardNo", type:"text"},
                @ {name:"车号", index:"CarNo_skip_true", type:"text"},
                @ {name:"客户代码", index:"CustNo", type:"text"},
                @ {name:"客户名称", index:"CustName", type:"text"},
                @ {name:"加油站点", index:"StationNo", type:"selectDiy", source:"station.diy"},
                @ {name:"油品代码", index:"OilNo", type:"text"},
                @ {name:"油品简称", index:"OilAbbreviate", type:"selectDiy", source:"oilTrade.oilSelect"}
                @];
                @ include("/common/_function/_search_multi.html",{"col":_col}){}
            @ }

        @ }

        <!-- 按钮 -->
        <div class="welljq well-sm" id="btns"></div>
        <!-- grid -->
        <table id="grid-table"></table>
        <!-- 分页-->
        <div id="grid-pager"></div>
    </div>
</div>

<!-- 引入所需的js -->
@include("/common/_listscript.html", {isExport : true}) {}

@}	